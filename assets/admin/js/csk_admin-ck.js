var attachments=[],selectedAttachment=[],att="",modalAction="";"use strict";var cskAdmin={init:function(){this.Media.init();this.sideBarMenuDropdown();$(".tooltip2").tooltip();this.BootrstrapAlert.init();this.selectCapabilities();this.deSelectCapabilities()},selectCapabilities:function(){$("body").on("click",".check-all-caps",function(e){e.preventDefault();$(':checkbox[name^="capability"]').prop("checked","checked")})},deSelectCapabilities:function(){$("body").on("click",".uncheck-all-caps",function(e){e.preventDefault();$(':checkbox[name^="capability"]').prop("checked",!1)})},sideBarMenuDropdown:function(){$(".sub-menu--extended:not(.active)").hover(function(){$(this).addClass("collapse");$(this).addClass("collapsed")},function(){$(".sub-menu--extended:not(.active)").removeClass("collapse").removeClass("collapsed")})},sideBarDrop:{init:function(){var e=this;this.oSidebarDropdown()},oSidebarDropdown:function(){}},BootrstrapAlert:{init:function(){$("body").on("click",".confirm-delete",function(e){e.preventDefault();var t=$(this);bootbox.confirm("<i class='fa fa-exclamation-triangle'></i>Are you sure you want to delete?",function(e){e&&(document.location.href=t.attr("href"))})})},confirmDelete:function(){$("body").on("click","#delete-single-entry",function(e){e.preventDefault();var t="",n="",r="";t='<button type="button" data-value="0" class="confirmBtn btn btn-default" data-dismiss="modal">Cancel</button>';t+='<button type="button" data-value="1" class="btn btn-primary confirmBtn" data-dismiss="modal">Continue</button>';n="Delete";r="Are you sure you want to delete?";cskAdmin.BootrstrapAlert.alertBox(n,r,t);var i=!1;$("body").one("click",".confirmBtn",function(e){e.preventDefault();var t=$(this);t.data("value")==1&&(i=!0);return!1});return i})},alertBox:function(e,t,n){var r=$("#defaultModal");r.find(".modal-footer").html(n);r.find(".modal-body").html(t);r.find(".modal-title").html(e);r.modal()},xActivate:function(e,t,n){var r="",i="",s="",o=$(e).val();if(o==-1)return;var u=$('input[name^="cid[]"]:checked');if(u.length==0){r='<button type="button" class="confirmBtn btn btn-primary" data-dismiss="modal">Close</button>';i="Message";s="No "+n+" selected";cskAdmin.BootrstrapAlert.alertBox(i,s,r);return}var a=[];u.each(function(){a.push($(this).val())});$.ajax({type:"post",url:baseURL+t,dataType:"json",data:{cid:a,status:o},success:function(e){tableHelper.ajaxTableHelper()}})},xdelete:function(e,t){var n="",r="",i="",s=$('input[name^="cid[]"]:checked');if(s.length==0){n='<button type="button" class="confirmBtn btn btn-primary" data-dismiss="modal">Close</button>';r="Message";i="No "+t+" selected";cskAdmin.BootrstrapAlert.alertBox(r,i,n);return}n='<button type="button" data-value="0" class="confirmBtn btn btn-default" data-dismiss="modal">Cancel</button>';n+='<button type="button" data-value="1" class="btn btn-primary confirmBtn" data-dismiss="modal">Continue</button>';r="Delete "+t;i="Are you sure you want to delete?";cskAdmin.BootrstrapAlert.alertBox(r,i,n);$("body").on("click",".confirmBtn",function(){if($(this).data("value")){var t=[];s.each(function(){t.push($(this).val())});$.ajax({type:"post",url:baseURL+e,dataType:"json",data:{cid:t},success:function(e){tableHelper.ajaxTableHelper()}})}});return!1},deleteTblist:function(e,t,n){var r=n.TBList("getCheckedItem",!0);if(count(r)<=0){footer='<button type="button" class="confirmBtn btn btn-primary" data-dismiss="modal">Close</button>';t="Message";body="No "+_title+" selected";cskAdmin.BootrstrapAlert.alertBox(t,body,footer);return}footer='<button type="button" data-value="0" class="confirmBtn btn btn-default" data-dismiss="modal">Cancel</button>';footer+='<button type="button" data-value="1" class="btn btn-primary confirmBtn" data-dismiss="modal">Continue</button>';t="Delete "+_title;body="Are you sure you want to delete?";cskAdmin.BootrstrapAlert.alertBox(t,body,footer);$("body").on("click",".confirmBtn",function(){$.ajax({type:"post",url:baseURL+_url,dataType:"json",data:{cid:r},success:function(e){n.TBList("refresh")}})})}},Media:{init:function(){this.setPostThumbnail();this.attachmentDetails();this.attach();this.saveAttachment();this.library();this.loadMore();this.search();this.fileUpload()},fileUpload:function(){var e=this;$("body").on("click",".upload-files",function(){$(".table tbody.files").html("")});$("body").on("click",".fileupload-buttonbar .start",function(){$("#load-more-media").removeAttr("disabled")})},saveAttachment:function(){$("body").on("change","#attachment-form :input",function(){var e=$(this),t=e.closest("form"),n=t.attr("action"),r=t.serialize();$(".settings-save-status .spinner").show();$.post(n,r).done(function(e){$(".settings-save-status .spinner").hide();$(".settings-save-status .saved").show().delay(3e3).fadeOut()})})},setPostThumbnail:function(){var e=this;$("body").on("click",".set-post-thumbnail",function(){var t=$(this);cskMain.Loader.layOpen(".img_panel_wrappr");modalAction="send-post-thumbnail";if(t.hasClass("panel__image-remove")){var n=$("#post_id").val();$.post(baseURL+"admin/delete-attachment",{post_id:n},function(){e.getPostAttachment();cskMain.Loader.layClose()})}else{var r=$("#defaultModal");r.addClass("modal--full");if($(".media-uploader").length==0)$.get(baseURL+"media/modal").done(function(e){r.html(e);r.modal();$(".media-library").trigger("click")});else{r.modal();$(".media-library").trigger("click")}cskMain.Loader.layClose();$(".media-library").trigger("click")}})},library:function(){var e=this;$("body").on("click",".media-library",function(){attachments=[];$(".media-listings__inner .media-attachments").html("");e.getMediaLibrary()})},search:function(){var e=this;$("body").on("keyup","#search-media",function(){if($(this).val().length<3&&$(this).val()!="")return!1;e.getMediaLibrary()})},loadMore:function(){var e=this;$("body").on("click","#load-more-media",function(){e.getMediaLibrary()})},getMediaLibrary:function(){var e=$("#search-media").val(),t=$(".modal-body .media__attachment").length;t=typeof t==undefined||e!=""?0:t;$.post(baseURL+"media/library",{s:e,totalAttachments:t},function(n){e!=""&&(attachments=[]);for(var r=0;r<n.row.length;r++)attachments.push(n.row[r]);var i="";if(attachments.length!=0){var s=t;for(var o=s;o<attachments.length;o++){i+='<li class="media__attachment">';i+='<div class="media__preview">';i+='<div class="media__thumbnail">';i+='<img src="'+baseURL+attachments[o].meta_data.sizes["post-thumbnail"]+'" alt="" class="media__thumbnail">';i+="</div>";i+="</div>";i+="</li>"}}e.length!=0?$(".media-listings__inner > .media-attachments").html(i):$(".media-listings__inner > .media-attachments").append(i);n.totalRows<=$(".media__attachment").length&&$("#load-more-media").attr("disabled","disabled")},"json")},attachmentDetails:function(){$("body").on("click",".modal-body .media__attachment",function(){var e=$(this),t=e.index(),n=attachments[t];if(e.hasClass("is-active"))for(var r=selectedAttachment.length-1;r>=0;r--)selectedAttachment[r].id===n.id&&selectedAttachment.splice(r,1);else{if(modalAction!="send-to-editor"){selectedAttachment=attachments[t];$(".media__attachment").removeClass("is-active")}else{var i=$.grep(selectedAttachment,function(e,t){return e.id==n.id});i.length==0&&selectedAttachment.push(n)}$.post(baseURL+"media/attachment",n).done(function(e){$(".media-attachment-details").html(e)})}e.toggleClass("is-active")})},attach:function(){var e=this;if(modalAction=="send-to-editor")return;$("body").on("click","#attach-to-post",function(){cskMain.Loader.layOpen(".img_panel_wrappr");$("#attachment").remove();var t=$("#post_id").val();$.post(baseURL+"media/attach",{post_id:t,attachment:selectedAttachment.id,type:"post",title:""}).done(function(){e.getPostAttachment();cskMain.Loader.layClose()})});$("body").on("click","#url-attach-to-post",function(){$("#attachment").remove();var t=$("#attachment_title"),n=$("#attachment_url"),r=n.val().match(/^http:\/\/(?:.*?)\.?(youtube|vimeo)\.com\/(watch\?[^#]*v=(\w+)|(\d+)).+$/);$(".invalid-url").remove();if(!r){$('<span class="alert-danger fade in invalid-url">Error: invalid url</span>').insertAfter(n);return!1}var i=$("#post_id").val();$.post(baseURL+"media/attach",{post_id:i,attachment:n.val(),type:"url",title:t.val()});e.getPostAttachment();$("#defaultModal").modal("hide")})},getPostAttachment:function(){if(modalAction=="send-to-editor")return;var e=$("#post_id").val();$.get(baseURL+"admin/post-attachment",{post_id:e,size:"post-thumbnail"}).done(function(e){$(".img_panel_wrappr").html(e)})}},taxSettingsPage:{init:function(){this.selectGateway()},selectGateway:function(){$("#select-gateway").change(function(){var e="#gateway-"+$(this).val();$("div[id^=gateway-]").hide();$(e).show()})}},taxRatePage:{init:function(){this.hasTax()},hasTax:function(){$("#has_tax").change(function(){$(this).val()==0?$("#has-tax-form").hide():$("#has-tax-form").show()});$("#has_tax").change()}},offsetRatePage:{init:function(){this.addBaseLevel();this.removeBaseLevel()},removeBaseLevel:function(){var e=this;$("body").on("click","#remove_base_level",function(t){t.preventDefault();if($("#base_levels .item-level").length>1){$(this).closest(".item-level").remove();e._resetBaseLevelIndex()}})},_resetBaseLevelIndex:function(){var e=0;$("#base_levels").find(".item-level").each(function(){var t="offset_rate_base_levels["+e+"][level_from]",n="offset_rate_base_levels["+e+"][level_to]",r="offset_rate_base_levels["+e+"][offset_rate]";$(this).find('input[name$="[level_from]"]').attr("name",t);$(this).find('input[name$="[level_to]"]').attr("name",n);$(this).find('input[name$="[offset_rate]"]').attr("name",r);e++})},addBaseLevel:function(){var e=this;$("#add_base_level").on("click",function(t){t.preventDefault();var n=$("#base_levels"),r=n.find(".item-level:first"),i=r.clone();i.appendTo(n);e._resetBaseLevelIndex();i.find("input,select,radio,checkbox").val("")})}}};